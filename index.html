<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revenue Projection Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header-container">
            <h1 id="mainTitle">🌏 APAC Revenue Projection Tool</h1>
            <div class="country-selector">
                <label for="countrySelect">Country:</label>
                <select id="countrySelect" onchange="changeCountry(this.value)">
                    <option value="india">🇮🇳 India</option>
                    <option value="singapore">🇸🇬 Singapore</option>
                    <option value="australia">🇦🇺 Australia</option>
                    <option value="japan">🇯🇵 Japan</option>
                    <option value="south_korea">🇰🇷 South Korea</option>
                    <option value="thailand">🇹🇭 Thailand</option>
                    <option value="indonesia">🇮🇩 Indonesia</option>
                    <option value="philippines">🇵🇭 Philippines</option>
                </select>
            </div>
        </div>
        <p class="subtitle">APAC Authentication Services Revenue Modeling with SKU-wise Market Intelligence (2024-25)</p>
        <p style="text-align: center; color: #8b5cf6; font-size: 0.9em; margin-bottom: 20px; font-weight: 500;">
            Version 2.2.0 - Enhanced CRUD Operations & Segment Management
        </p>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('setup')">📊 Setup & Segments</div>
            <div class="tab" onclick="switchTab('projections')">📈 Projections</div>
            <div class="tab" onclick="switchTab('analysis')">🔍 Analysis</div>
            <div class="tab" onclick="switchTab('demographics')">🌏 Demographics</div>
            <div class="tab" onclick="switchTab('models')">💾 Saved Models</div>
        </div>

        <!-- Setup Tab -->
        <div class="tab-content active" id="setup">
            <div class="input-section">
                <div class="input-group">
                    <label for="startRevenue">Base Monthly Revenue (₹)</label>
                    <input type="number" id="startRevenue" value="0" min="0">
                </div>
                
                <div class="input-group">
                    <label for="growthRate">Base Growth Rate (% monthly)</label>
                    <input type="number" id="growthRate" value="8" step="0.1" min="-100" max="100">
                </div>
                
                <div class="input-group">
                    <label for="projectionMonths">Projection Period (Months)</label>
                    <input type="number" id="projectionMonths" value="12" min="1" max="60">
                </div>
                
                <div class="input-group">
                    <label for="costPercentage">Base COGS (% of Revenue)</label>
                    <input type="number" id="costPercentage" value="40" step="1" min="0" max="100">
                </div>
                
                <div class="input-group">
                    <label for="operatingExpenseType">Operating Expense Type</label>
                    <select id="operatingExpenseType" onchange="toggleOperatingExpenseInputs()">
                        <option value="fixed">Fixed Monthly Amount</option>
                        <option value="percentage">Percentage of Revenue</option>
                        <option value="hybrid">Fixed + Percentage</option>
                    </select>
                </div>
                
                <div class="input-group" id="fixedExpenseGroup">
                    <label for="operatingExpenses">Base Operating Expenses (₹)</label>
                    <input type="number" id="operatingExpenses" value="0" min="0" onchange="updateProfitabilityWarning()">
                </div>
                
                <div class="input-group" id="percentageExpenseGroup" style="display: none;">
                    <label for="operatingExpensePercentage">Operating Expenses (% of Revenue)</label>
                    <input type="number" id="operatingExpensePercentage" value="15" min="0" max="100" step="0.1" onchange="updateProfitabilityWarning()">
                </div>
                
                <div class="input-group">
                    <label for="seasonality">Seasonality Factor</label>
                    <select id="seasonality">
                        <option value="none">None</option>
                        <option value="retail">Retail (Q4 Peak)</option>
                        <option value="summer">Summer Peak</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="usdRate">USD Exchange Rate (₹/USD)</label>
                    <input type="number" id="usdRate" value="83.50" step="0.01" min="1">
                </div>
            </div>

            <div class="segment-builder">
                <div class="segment-header">
                    <h3>SKUs (Stock Keeping Units)</h3>
                    <div class="view-selector">
                        <button class="view-btn active" onclick="setView('consolidated')">Consolidated</button>
                        <button class="view-btn" onclick="setView('segmented')">By SKU</button>
                    </div>
                </div>

                <div class="pension-context" id="marketContext">
                    <h4 id="marketContextTitle">🔍 Digital Authentication Market Context</h4>
                    <div id="marketContextContent">
                        <p style="margin-bottom: 10px;">
                            <strong>1. Authentication Services</strong><br>
                            • <strong>OTP (SMS):</strong> 50+ billion transactions annually • ₹0.10-0.15/SMS • Banking, e-commerce, govt services<br>
                            • <strong>Biometric:</strong> 5.2 crore pension + banking • ₹2-5/transaction • Aadhaar-based fingerprint/iris verification
                        </p>
                        <p style="margin-bottom: 10px;">
                            <strong>2. KYC (eKYC)</strong><br>
                            • 200+ crore annual verifications • ₹15-25/verification • Banking, telecom, mutual funds, insurance onboarding
                        </p>
                        <p>
                            <strong>3. Tokenization</strong><br>
                            • 15+ billion card transactions • ₹0.50-1.50/tokenization • Payment security, card data protection, UPI growth
                        </p>
                    </div>
                </div>

                <div class="segment-type-selector">
                    <button class="segment-type-btn active" data-type="sku">Authentication SKUs</button>
                    <button class="segment-type-btn" data-type="custom">Custom SKU</button>
                </div>

                <div class="predefined-segments" id="predefinedSegments"></div>

                <div class="add-segment-section">
                    <div class="input-group">
                        <label for="segmentName">SKU Name</label>
                        <input type="text" id="segmentName" placeholder="e.g., OTP SMS, Biometric Auth">
                    </div>
                    <div class="input-group">
                        <label for="pricePerTransaction">Price/Transaction (₹)</label>
                        <input type="number" id="pricePerTransaction" placeholder="0.15" step="0.01" min="0">
                    </div>
                    <div class="input-group">
                        <label for="costPerTransaction">Cost/Transaction (₹)</label>
                        <input type="number" id="costPerTransaction" placeholder="0.10" step="0.01" min="0">
                    </div>
                    <div class="input-group">
                        <label for="monthlyVolume">Monthly Volume</label>
                        <input type="number" id="monthlyVolume" placeholder="1000000" min="0">
                    </div>
                    <div class="input-group">
                        <label for="volumeGrowth">Volume Growth (%/month)</label>
                        <input type="number" id="volumeGrowth" placeholder="5" step="0.1" value="5">
                    </div>
                    <div class="input-group">
                        <label for="segmentCategory">Category</label>
                        <select id="segmentCategory">
                            <option value="authentication">Authentication</option>
                            <option value="kyc">KYC/eKYC</option>
                            <option value="biometric">Biometric</option>
                            <option value="tokenization">Tokenization</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label for="segmentNotes">Notes (Optional)</label>
                        <input type="text" id="segmentNotes" placeholder="Additional details or assumptions">
                    </div>
                    <button class="btn-primary btn-small" onclick="addOrUpdateSegment()">Add Segment</button>
                    <button class="btn-warning btn-small" onclick="addTestSegment()">Add Test SKU</button>
                    <button class="btn-secondary btn-small" onclick="clearSegmentForm()">Clear Form</button>
                </div>

                <div class="segment-management-tools">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center; margin-bottom: 15px;">
                        <button class="btn-primary btn-small" onclick="showSegmentLibraryDialog()">📚 Segment Library</button>
                        <button class="btn-success btn-small" onclick="exportSegments()">📤 Export Segments</button>
                        <button class="btn-success btn-small" onclick="importSegments()">📥 Import Segments</button>
                        <button class="btn-info btn-small" onclick="loadSegmentsFromExternalLibrary()">📁 Load External SKUs</button>
                        <button class="btn-primary btn-small" onclick="createTelanganaModel()">🏛️ Telangana Model</button>
                        <button class="btn-warning btn-small" onclick="duplicateSelectedSegments()">📋 Duplicate Selected</button>
                        <button class="btn-warning btn-small" onclick="deleteSelectedSegments()">🗑️ Delete Selected</button>
                        <input type="file" id="segmentImportFile" accept=".json,.csv" style="display: none;" onchange="handleSegmentImportFile(event)">
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                        <input type="text" id="segmentSearchFilter" placeholder="Search segments..." style="flex: 1; min-width: 200px;" onkeyup="filterSegments()" />
                        <select id="categoryFilter" onchange="filterSegments()">
                            <option value="">All Categories</option>
                            <option value="authentication">Authentication</option>
                            <option value="kyc">KYC/eKYC</option>
                            <option value="biometric">Biometric</option>
                            <option value="tokenization">Tokenization</option>
                            <option value="custom">Custom</option>
                        </select>
                        <button class="btn-secondary btn-small" onclick="clearFilters()">Clear Filters</button>
                        <div style="font-size: 0.9em; color: #666;">
                            <span id="segmentCount">0</span> segments
                        </div>
                    </div>
                </div>

                <div class="segments-list" id="segmentsList"></div>
            </div>

            <div id="profitabilityWarning" style="margin: 15px 0; padding: 10px; border-radius: 5px; background-color: #f0f4ff; display: none;"></div>
            
            <div class="buttons">
                <button class="btn-primary" onclick="calculateProjections()">Calculate Projections</button>
                <button class="btn-warning" onclick="loadPensionModel()">📊 Load Demographic Data</button>
                <button class="btn-warning" onclick="runScenarios()">Run Scenarios</button>
                <button class="btn-success" onclick="showSaveModelDialog()">💾 Save Current Model</button>
                <button class="btn-primary" onclick="loadExternalModelConfig()">📁 Load External Config</button>
                <input type="file" id="modelConfigFile" accept=".json" style="display: none;" onchange="handleModelConfigFile(event)">
            </div>
        </div>

        <!-- Projections Tab -->
        <div class="tab-content" id="projections">
            <div class="results-section" id="results" style="display: none;">
                <div class="summary-cards" id="summaryCards"></div>
                <div class="segment-breakdown" id="segmentBreakdown" style="display: none;"></div>
                <div class="chart-container">
                    <div class="chart-controls">
                        <div class="chart-control">
                            <label for="chartMetric">Metric:</label>
                            <select id="chartMetric" onchange="updateChart()">
                                <option value="revenue">Revenue</option>
                                <option value="profit">Net Profit</option>
                                <option value="margin">Profit Margin</option>
                                <option value="volume">Transaction Volume</option>
                            </select>
                        </div>
                        <div class="chart-control">
                            <label for="chartView">View:</label>
                            <select id="chartView" onchange="updateChart()">
                                <option value="total">Total</option>
                                <option value="segments">By Segment</option>
                            </select>
                        </div>
                        <div class="chart-control">
                            <label for="chartPeriod">Period:</label>
                            <select id="chartPeriod" onchange="updateChart()">
                                <option value="1M">1 Month (Daily)</option>
                                <option value="1Y" selected>1 Year</option>
                                <option value="2Y">2 Years</option>
                                <option value="5Y">5 Years</option>
                                <option value="10Y">10 Years</option>
                            </select>
                        </div>
                    </div>
                    <canvas id="revenueChart"></canvas>
                </div>
                <div class="table-controls" id="tableControls" style="display: none; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <label class="toggle-switch">
                                <input type="checkbox" id="monthlyBreakdown" onchange="toggleMonthlyBreakdown()">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Show Monthly Breakdown</span>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-secondary btn-small" onclick="exportTableData('csv')">📄 Export CSV</button>
                            <button class="btn-secondary btn-small" onclick="exportTableData('excel')">📊 Export Excel</button>
                        </div>
                    </div>
                </div>
                <table id="projectionTable"></table>
            </div>
        </div>

        <!-- Analysis Tab -->
        <div class="tab-content" id="analysis">
            <!-- Demographic Insights Section -->
            <div class="demographic-insights" id="demographicInsights" style="margin-bottom: 25px;">
                <h2>📊 Demographic Insights</h2>
                <div class="insights-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 20px;">
                    <div class="insight-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #f9fafb;">
                        <h4 style="margin: 0 0 10px 0; color: #374151;">Current Country Overview</h4>
                        <div id="countryOverview">
                            <div>Total Population: <span id="totalPopulation">-</span>M</div>
                            <div>Available Segments: <span id="totalSegments">-</span></div>
                            <div>Average Auth Rate: <span id="avgAuthRate">-</span>%</div>
                            <div>Average Pension Rate: <span id="avgPensionRate">-</span>%</div>
                        </div>
                    </div>
                    <div class="insight-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #f9fafb;">
                        <h4 style="margin: 0 0 10px 0; color: #374151;">Digital Readiness</h4>
                        <div id="digitalReadiness">
                            <div>Avg Digital Adoption: <span id="avgDigitalAdoption">-</span>%</div>
                            <div>High Digital Segments: <span id="highDigitalSegments">-</span></div>
                            <div>Urbanization Level: <span id="avgUrbanization">-</span>%</div>
                        </div>
                    </div>
                    <div class="insight-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #f9fafb;">
                        <h4 style="margin: 0 0 10px 0; color: #374151;">Economic Profile</h4>
                        <div id="economicProfile">
                            <div>High Economic Tier: <span id="highEconomicSegments">-</span></div>
                            <div>Medium Economic Tier: <span id="mediumEconomicSegments">-</span></div>
                            <div>Low Economic Tier: <span id="lowEconomicSegments">-</span></div>
                        </div>
                    </div>
                    <div class="insight-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 15px; background: #f9fafb;">
                        <h4 style="margin: 0 0 10px 0; color: #374151;">Growth Potential</h4>
                        <div id="growthPotential">
                            <div>Avg Growth Rate: <span id="avgGrowthRate">-</span>%</div>
                            <div>Fast Growing Segments: <span id="fastGrowingSegments">-</span></div>
                            <div>Revenue Potential: <span id="revenueOpportunity">-</span></div>
                        </div>
                    </div>
                </div>
                <div class="buttons" style="text-align: center; margin-bottom: 20px;">
                    <button class="btn-info" onclick="refreshDemographicInsights()" style="margin-right: 10px;">🔄 Refresh Insights</button>
                    <button class="btn-secondary" onclick="showDemographicDetails()">📈 View Details</button>
                </div>
            </div>
            
            <div class="scenario-section" id="scenarioSection" style="display: none;">
                <h2>Scenario Analysis</h2>
                <div class="scenario-results" id="scenarioResults"></div>
            </div>
            <div class="buttons">
                <button class="btn-success" onclick="exportToExcel()">Export to Excel</button>
            </div>
        </div>

        <!-- Demographics Tab -->
        <div class="tab-content" id="demographics">
            <div class="demographics-header">
                <h2>🌏 APAC Demographics Intelligence</h2>
                <p style="color: #666; margin-bottom: 25px;">Explore comprehensive demographic data across all APAC countries with advanced comparison and analysis tools.</p>
                
                <!-- Demographics Navigation -->
                <div class="demographics-nav">
                    <button type="button" class="demo-nav-btn active" data-section="overview" onclick="showDemographicOverview()">📊 Overview</button>
                    <button type="button" class="demo-nav-btn" data-section="explorer" onclick="showCountryExplorer()">🔍 Country Explorer</button>
                    <button type="button" class="demo-nav-btn" data-section="comparison" onclick="showCountryComparison()">⚖️ Compare Countries</button>
                    <button type="button" class="demo-nav-btn" data-section="analysis" onclick="showSegmentAnalysis()">🎯 Segment Analysis</button>
                    <button type="button" class="demo-nav-btn" data-section="export" onclick="exportDemographicData()">📤 Export Data</button>
                </div>
            </div>
            
            <!-- Demographics Overview Section -->
            <div id="demographicOverviewSection" class="demographic-section">
                <h3>📊 APAC Demographics Overview</h3>
                <div id="demographicOverviewContent">
                    <div class="overview-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 25px;">
                        <div class="overview-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                            <h4 style="margin: 0 0 15px 0;">Regional Summary</h4>
                            <div id="regionalSummary">
                                <div>Total Countries: <span id="totalCountriesOverview">8</span></div>
                                <div>Total Segments: <span id="totalSegmentsOverview">-</span></div>
                                <div>Combined Population: <span id="totalPopulationOverview">-</span>M</div>
                                <div>Avg Auth Rate: <span id="avgAuthRateOverview">-</span>%</div>
                                <div>Avg Pension Rate: <span id="avgPensionRateOverview">-</span>%</div>
                            </div>
                        </div>
                        <div class="overview-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                            <h4 style="margin: 0 0 15px 0;">Digital Landscape</h4>
                            <div id="digitalLandscape">
                                <div>Avg Digital Adoption: <span id="avgDigitalAdoptionOverview">-</span>%</div>
                                <div>High Digital Countries: <span id="highDigitalCountriesOverview">-</span></div>
                                <div>Avg Urbanization: <span id="avgUrbanizationOverview">-</span>%</div>
                                <div>Growth Rate Range: <span id="growthRateRangeOverview">-</span>%</div>
                            </div>
                        </div>
                        <div class="overview-card" style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 20px; background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                            <h4 style="margin: 0 0 15px 0;">Economic Profile</h4>
                            <div id="economicProfile">
                                <div>High Economic Segments: <span id="highEconomicSegmentsOverview">-</span></div>
                                <div>Medium Economic Segments: <span id="mediumEconomicSegmentsOverview">-</span></div>
                                <div>Low Economic Segments: <span id="lowEconomicSegmentsOverview">-</span></div>
                                <div>Revenue Opportunity: <span id="revenueOpportunityOverview">-</span></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="country-summary-table" style="margin-top: 25px;">
                        <h4>Country Summary</h4>
                        <div style="overflow-x: auto;">
                            <table id="countrySummaryTable" style="width: 100%; border-collapse: collapse; font-size: 14px;">
                                <thead>
                                    <tr style="background: #f3f4f6;">
                                        <th style="border: 1px solid #d1d5db; padding: 12px; text-align: left;">Country</th>
                                        <th style="border: 1px solid #d1d5db; padding: 12px; text-align: right;">Pop (M)</th>
                                        <th style="border: 1px solid #d1d5db; padding: 12px; text-align: right;">Segments</th>
                                        <th style="border: 1px solid #d1d5db; padding: 12px; text-align: right;">Auth %</th>
                                        <th style="border: 1px solid #d1d5db; padding: 12px; text-align: right;">Digital %</th>
                                        <th style="border: 1px solid #d1d5db; padding: 12px; text-align: right;">Urban %</th>
                                        <th style="border: 1px solid #d1d5db; padding: 12px; text-align: center;">Top Tier</th>
                                        <th style="border: 1px solid #d1d5db; padding: 12px; text-align: center;">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="countrySummaryTableBody">
                                    <!-- Will be populated dynamically -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Country Explorer Section -->
            <div id="countryExplorerSection" class="demographic-section" style="display: none;">
                <h3>🔍 Country Explorer</h3>
                <div class="country-explorer-controls" style="margin-bottom: 20px;">
                    <label for="explorerCountrySelect" style="font-weight: bold; margin-right: 10px;">Select Country:</label>
                    <select id="explorerCountrySelect" onchange="loadCountryDetails(this.value)" style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px; margin-right: 15px;">
                        <option value="">Choose a country...</option>
                        <option value="india">🇮🇳 India</option>
                        <option value="singapore">🇸🇬 Singapore</option>
                        <option value="australia">🇦🇺 Australia</option>
                        <option value="japan">🇯🇵 Japan</option>
                        <option value="south_korea">🇰🇷 South Korea</option>
                        <option value="thailand">🇹🇭 Thailand</option>
                        <option value="indonesia">🇮🇩 Indonesia</option>
                        <option value="philippines">🇵🇭 Philippines</option>
                    </select>
                    <button class="btn-info" onclick="loadCountryDetails(document.getElementById('explorerCountrySelect').value)">🔄 Refresh</button>
                </div>
                <div id="countryDetailsContent">
                    <p style="color: #666; text-align: center; padding: 40px;">Select a country above to explore its demographic data in detail.</p>
                </div>
            </div>
            
            <!-- Country Comparison Section -->
            <div id="countryComparisonSection" class="demographic-section" style="display: none;">
                <h3>⚖️ Country Comparison</h3>
                <div class="comparison-controls" style="margin-bottom: 25px; display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                    <div>
                        <label for="compareCountry1" style="font-weight: bold; margin-right: 8px;">Country 1:</label>
                        <select id="compareCountry1" style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                            <option value="">Select first country...</option>
                            <option value="india">🇮🇳 India</option>
                            <option value="singapore">🇸🇬 Singapore</option>
                            <option value="australia">🇦🇺 Australia</option>
                            <option value="japan">🇯🇵 Japan</option>
                            <option value="south_korea">🇰🇷 South Korea</option>
                            <option value="thailand">🇹🇭 Thailand</option>
                            <option value="indonesia">🇮🇩 Indonesia</option>
                            <option value="philippines">🇵🇭 Philippines</option>
                        </select>
                    </div>
                    <div>
                        <label for="compareCountry2" style="font-weight: bold; margin-right: 8px;">Country 2:</label>
                        <select id="compareCountry2" style="padding: 8px; border: 1px solid #d1d5db; border-radius: 4px;">
                            <option value="">Select second country...</option>
                            <option value="india">🇮🇳 India</option>
                            <option value="singapore">🇸🇬 Singapore</option>
                            <option value="australia">🇦🇺 Australia</option>
                            <option value="japan">🇯🇵 Japan</option>
                            <option value="south_korea">🇰🇷 South Korea</option>
                            <option value="thailand">🇹🇭 Thailand</option>
                            <option value="indonesia">🇮🇩 Indonesia</option>
                            <option value="philippines">🇵🇭 Philippines</option>
                        </select>
                    </div>
                    <button class="btn-primary" onclick="compareCountries()">🔍 Compare</button>
                    <button class="btn-secondary" onclick="clearComparison()">🗑️ Clear</button>
                </div>
                <div id="comparisonContent">
                    <p style="color: #666; text-align: center; padding: 40px;">Select two countries above to see a detailed side-by-side comparison.</p>
                </div>
            </div>
            
            <!-- Segment Analysis Section -->
            <div id="segmentAnalysisSection" class="demographic-section" style="display: none;">
                <h3>🎯 Segment Analysis</h3>
                <div class="segment-analysis-controls" style="margin-bottom: 20px;">
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <div>
                            <label for="segmentFilterEconomic" style="font-weight: bold; margin-right: 8px;">Economic Tier:</label>
                            <select id="segmentFilterEconomic" style="padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                                <option value="">All Tiers</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div>
                            <label for="segmentFilterDigital" style="font-weight: bold; margin-right: 8px;">Min Digital %:</label>
                            <input type="number" id="segmentFilterDigital" min="0" max="100" placeholder="0" style="width: 80px; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                        </div>
                        <div>
                            <label for="segmentFilterGrowth" style="font-weight: bold; margin-right: 8px;">Min Growth %:</label>
                            <input type="number" id="segmentFilterGrowth" min="0" max="50" placeholder="0" style="width: 80px; padding: 6px; border: 1px solid #d1d5db; border-radius: 4px;">
                        </div>
                        <button class="btn-primary" onclick="filterSegments()">🔍 Filter</button>
                        <button class="btn-secondary" onclick="resetSegmentFilters()">🔄 Reset</button>
                    </div>
                </div>
                <div id="segmentAnalysisContent">
                    <p style="color: #666; text-align: center; padding: 40px;">Use the filters above to analyze segments across all APAC countries.</p>
                </div>
            </div>
        </div>

        <!-- Saved Models Tab -->
        <div class="tab-content" id="models">
            <div class="models-header">
                <h2>📊 Saved Revenue Models</h2>
                <p style="color: #666; margin-bottom: 30px;">Save, load, and manage your revenue projection scenarios with different SKUs, pricing, and market assumptions.</p>
            </div>

            <div class="models-actions">
                <button class="btn-primary" onclick="createBlankModel()">✨ New Model</button>
                <button class="btn-primary" onclick="showSaveModelDialog()">💾 Save Current Model</button>
                <button class="btn-warning" onclick="exportAllModels()">📤 Export All Models</button>
                <button class="btn-success" onclick="importModels()">📥 Import Models</button>
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImportFile(event)">
            </div>

            <div class="models-grid" id="modelsGrid">
                <!-- Models will be populated here -->
            </div>
        </div>
    </div>

    <!-- Save Model Dialog -->
    <div id="saveModelDialog" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>💾 Save Revenue Model</h3>
                <span class="modal-close" onclick="closeSaveModelDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label for="modelName">Model Name *</label>
                    <input type="text" id="modelName" placeholder="e.g., Authentication SKU Mix Q1 2025" required>
                </div>
                <div class="input-group">
                    <label for="modelDescription">Description</label>
                    <textarea id="modelDescription" placeholder="Brief description of this revenue model..." rows="3"></textarea>
                </div>
                <div class="input-group">
                    <label for="modelTags">Tags (comma-separated)</label>
                    <input type="text" id="modelTags" placeholder="e.g., authentication, biometric, Q1-2025">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="saveCurrentModel()">Save Model</button>
                <button class="btn-secondary" onclick="closeSaveModelDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Segment Library Dialog -->
    <div id="segmentLibraryDialog" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>📚 Segment Library</h3>
                <span class="modal-close" onclick="closeSegmentLibraryDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <p>Select pre-configured segments to add to your current model. You can select multiple segments and customize them after adding.</p>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                    <button class="view-btn active" onclick="setLibraryFilter('all')">All Categories</button>
                    <button class="view-btn" onclick="setLibraryFilter('authentication')">Authentication</button>
                    <button class="view-btn" onclick="setLibraryFilter('kyc')">KYC/eKYC</button>
                    <button class="view-btn" onclick="setLibraryFilter('biometric')">Biometric</button>
                    <button class="view-btn" onclick="setLibraryFilter('tokenization')">Tokenization</button>
                </div>
                
                <div class="segment-library-grid" id="segmentLibraryGrid">
                    <!-- Library segments will be populated here -->
                </div>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <span id="selectedLibraryCount">0</span> segments selected
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-secondary" onclick="clearLibrarySelection()">Clear Selection</button>
                            <button class="btn-primary" onclick="addSelectedLibrarySegments()">Add Selected Segments</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeSegmentLibraryDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Model Details Dialog -->
    <div id="modelDetailsDialog" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modelDetailsTitle">📊 Model Details</h3>
                <span class="modal-close" onclick="closeModelDetailsDialog()">&times;</span>
            </div>
            <div class="modal-body" id="modelDetailsBody">
                <!-- Model details will be populated here -->
            </div>
            <div class="modal-footer">
                <button class="btn-primary" id="loadModelBtn" onclick="loadSelectedModel()">Load Model</button>
                <button class="btn-success" id="editModelBtn" onclick="editSelectedModel()">✏️ Edit</button>
                <button class="btn-warning" id="deleteModelBtn" onclick="deleteSelectedModel()">Delete</button>
                <button class="btn-secondary" onclick="closeModelDetailsDialog()">Close</button>
            </div>
        </div>
    </div>

    <!-- SKU Edit Dialog -->
    <div id="skuEditDialog" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="skuEditTitle">✏️ Edit SKU</h3>
                <span class="modal-close" onclick="closeSkuEditDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="skuEditForm">
                    <div class="input-group">
                        <label for="editSkuName">SKU Name</label>
                        <input type="text" id="editSkuName" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="editSkuPrice">Price per Transaction (₹)</label>
                        <input type="number" id="editSkuPrice" step="0.01" min="0" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="editSkuCost">Cost per Transaction (₹)</label>
                        <input type="number" id="editSkuCost" step="0.01" min="0" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="editSkuVolume">Monthly Volume</label>
                        <input type="number" id="editSkuVolume" min="1" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="editSkuGrowth">Volume Growth (% monthly)</label>
                        <input type="number" id="editSkuGrowth" step="0.1" value="5">
                    </div>
                    
                    <div class="input-group">
                        <label for="editSkuCategory">Category</label>
                        <select id="editSkuCategory">
                            <option value="authentication">Authentication</option>
                            <option value="verification">Verification</option>
                            <option value="biometric">Biometric</option>
                            <option value="government">Government</option>
                            <option value="financial">Financial</option>
                            <option value="healthcare">Healthcare</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="editSkuNotes">Notes</label>
                        <textarea id="editSkuNotes" rows="3" placeholder="Additional details about this SKU..."></textarea>
                    </div>
                    
                    <div id="skuEditValidation" style="margin-top: 15px; display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="updateSku()">💾 Update SKU</button>
                <button class="btn-warning" onclick="duplicateCurrentSku()">📋 Duplicate</button>
                <button class="btn-danger" onclick="deleteCurrentSku()">🗑️ Delete</button>
                <button class="btn-secondary" onclick="closeSkuEditDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Model Edit Dialog -->
    <div id="modelEditDialog" class="modal" style="display: none;">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modelEditTitle">✏️ Edit Model</h3>
                <span class="modal-close" onclick="closeModelEditDialog()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="modelEditForm">
                    <div class="input-group">
                        <label for="editModelName">Model Name</label>
                        <input type="text" id="editModelName" required maxlength="100">
                    </div>
                    
                    <div class="input-group">
                        <label for="editModelDescription">Description</label>
                        <textarea id="editModelDescription" rows="3" placeholder="Describe this revenue model..." maxlength="500"></textarea>
                    </div>
                    
                    <div class="input-group">
                        <label for="editModelTags">Tags (comma-separated)</label>
                        <input type="text" id="editModelTags" placeholder="e.g., pension, authentication, biometric">
                    </div>
                    
                    <div class="model-params-edit">
                        <h4>Model Parameters</h4>
                        
                        <div class="params-row">
                            <div class="input-group">
                                <label for="editProjectionMonths">Projection Period (months)</label>
                                <input type="number" id="editProjectionMonths" min="1" max="120" value="12">
                            </div>
                            
                            <div class="input-group">
                                <label for="editGrowthRate">Growth Rate (% monthly)</label>
                                <input type="number" id="editGrowthRate" step="0.1" value="5">
                            </div>
                        </div>
                        
                        <div class="params-row">
                            <div class="input-group">
                                <label for="editCostPercentage">COGS (% of revenue)</label>
                                <input type="number" id="editCostPercentage" min="0" max="100" step="1" value="40">
                            </div>
                            
                            <div class="input-group">
                                <label for="editOperatingExpenses">Operating Expenses (₹)</label>
                                <input type="number" id="editOperatingExpenses" min="0" value="500000">
                            </div>
                        </div>
                        
                        <div class="params-row">
                            <div class="input-group">
                                <label for="editSeasonality">Seasonality</label>
                                <select id="editSeasonality">
                                    <option value="none">None</option>
                                    <option value="low">Low</option>
                                    <option value="moderate">Moderate</option>
                                    <option value="high">High</option>
                                </select>
                            </div>
                            
                            <div class="input-group">
                                <label for="editUsdRate">USD Exchange Rate</label>
                                <input type="number" id="editUsdRate" step="0.01" min="1" value="83.50">
                            </div>
                        </div>
                    </div>
                    
                    <div id="modelEditValidation" style="margin-top: 15px; display: none;"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-primary" onclick="updateModel()">💾 Update Model</button>
                <button class="btn-warning" onclick="duplicateModel()">📋 Duplicate Model</button>
                <button class="btn-secondary" onclick="closeModelEditDialog()">Cancel</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    </script>
</body>
</html>